<nav class="navbar navbar-light bg-primary mb-4 shadow-sm">
  <div class="container-fluid">
    <h1 class="text-white m-0 fs-3">Gestion des Produits</h1>
  </div>
</nav>

<div class="container">
  <!-- search  -->
  <div class="row mb-4">
    <div class="col-md-6 mx-auto">
      <div class="input-group search-bar shadow-sm">
        <span class="input-group-text bg-white border-end-0">
          <i class="bi bi-search"></i>
        </span>
        <input type="text" class="form-control border-start-0 ps-0" placeholder="Rechercher un produit..."
          [(ngModel)]="searchTerm" (ngModelChange)="filterProduit()" />
        <button class="btn btn-primary" type="button" (click)="filterProduit()">Rechercher</button>
      </div>
    </div>
  </div>

  <!-- product card -->
  <div class="row g-4">
    <div class="col-md-4 col-sm-6" *ngFor="
        let row of filteredProduitData
          | slice : (currentPage - 1) * pageSize : currentPage * pageSize
      ">
      <div class="card h-100 product-card shadow-sm border-0">
        <div class="card-img-wrapper">
          <span class="badge bg-primary category-badge">{{
            row.category
            }}</span>
          <img [src]="row.images[0]" class="card-img-top" alt="{{ row.name }}" />
        </div>
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <h5 class="card-title fw-bold text-dark mb-0">{{ row.name }}</h5>
            <span class="badge bg-success" *ngIf="row.stock > 0">Stock: {{ row.stock }}</span>
            <span class="badge bg-danger" *ngIf="row.stock === 0">Out of Stock</span>
          </div>
          <p class="card-text text-muted flex-grow-1">{{ row.description }}</p>

          <div class="d-flex gap-2 mt-3 pt-3 border-top">
            <button class="btn btn-outline-info flex-grow-1" (click)="onEdit(row)" data-bs-toggle="modal"
              data-bs-target="#staticBackdrop">
              <i class="bi bi-pencil-fill"></i> Edit
            </button>
            <button class="btn btn-outline-danger flex-grow-1" (click)="deleteProduit(row)">
              <i class="bi bi-trash-fill"></i> Delete
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="text-center mt-5" *ngIf="filteredProduitData.length == 0">
    <div class="text-muted fs-4">Aucun produit trouve</div>
  </div>

  <!-- pagination -->
  <div class="d-flex justify-content-center mt-5 mb-5">
    <nav aria-label="Page navigation">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="prevPage()" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
          </button>
        </li>
        <li class="page-item" *ngFor="let page of pagesArray" [class.active]="currentPage === page">
          <button class="page-link" (click)="changePage(page)">
            {{ page }}
          </button>
        </li>
        <li class="page-item" [class.disabled]="
            currentPage * pageSize >= filteredProduitData.length
          ">
          <button class="page-link" (click)="nextPage()" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </button>
        </li>
      </ul>
    </nav>
  </div>
</div>

<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" tabindex="-1" role="dialog"
  aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="staticBackdropLabel">Détails du Produit</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <form [formGroup]="formValue">
          <div class="mb-3">
            <label for="name" class="form-label fw-bold">Nom</label>
            <input type="text" class="form-control" formControlName="name" id="name" />
          </div>
          <div class="mb-3">
            <label for="description" class="form-label fw-bold">Description</label>
            <textarea class="form-control" formControlName="description" id="description" rows="3"></textarea>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="stock" class="form-label fw-bold">Stock</label>
              <input type="number" class="form-control" formControlName="stock" id="stock" />
            </div>
            <div class="col-md-6 mb-3">
              <label for="category" class="form-label fw-bold">Catégorie</label>
              <select class="form-select" formControlName="category" id="category">
                <option value="" disabled selected>Choisir...</option>
                <option *ngFor="let cat of api.categories" [value]="cat">
                  {{ cat }}
                </option>
              </select>
            </div>
          </div>
          <div class="mb-3">
            <label for="images" class="form-label fw-bold">Image URL</label>
            <input type="text" class="form-control" formControlName="images" id="images" />
          </div>
        </form>
      </div>
      <div class="modal-footer border-top-0 bg-light">
        <button type="button" id="cancel" class="btn btn-secondary" data-bs-dismiss="modal">
          Fermer
        </button>
        <button type="button" (click)="updateProduitDetails()" class="btn btn-warning text-white"
          data-bs-dismiss="modal">
          Mettre à jour
        </button>
      </div>
    </div>
  </div>
</div>